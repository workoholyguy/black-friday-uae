<header class="site-header full-width">
  {% liquid
    assign locale_code = localization.language.iso_code | default: request.locale.iso_code | default: 'en'
    assign locale_param = 'locale=' | append: locale_code
  %}
  <div class="header__top">
    <div class="header__brand">
      <a
        class="header__home"
        href="{{ routes.root_url | append: '?' | append: locale_param }}"
        aria-label="{{ shop.name }}"
      >
        {% if section.settings.logo != blank %}
          {{ section.settings.logo | image_url: width: 180 | image_tag: alt: shop.name, class: 'header__logo' }}
        {% else %}
          <img
            class="header__logo"
            src="{{ 'BFD UAE horizontal Logo 2.png' | asset_url }}"
            alt="{{ shop.name | escape }}"
            width="270"
            height="52"
            loading="eager"
          >
        {% endif %}
      </a>
    </div>

    <div class="header__search">
      <form class="search-form" action="{{ routes.search_url }}" method="get" role="search">
        <input
          class="search-input"
          type="search"
          name="q"
          value="{{ search.terms | escape }}"
          placeholder="{{ 'search.placeholder' | t }}"
          aria-label="{{ 'search.title' | t }}"
        >
        <button class="search-submit" type="submit">{{ 'search.submit' | t }}</button>
      </form>
    </div>

    <div class="header__utilities">
      <div class="header__lang">
        {%- form 'localization', class: 'lang-form' -%}
          <input
            type="hidden"
            name="locale_code"
            value="{% if localization.language.iso_code contains 'ar' %}en{% else %}ar{% endif %}"
          >
          <button type="submit" class="lang-button">
            {% if localization.language.iso_code contains 'ar' -%}
              English
            {%- else -%}
              العربية
            {% endif %}
          </button>
        {%- endform -%}
      </div>
      <div class="header__icons">
        {% if shop.customer_accounts_enabled %}
          <a class="header__account" href="{{ routes.account_url }}">{{ 'customers.login.title' | t }}</a>
        {% endif %}
        <a class="header__cart" href="{{ routes.cart_url }}?{{ locale_param }}" aria-label="{{ 'cart.title' | t }}">
          {% if cart.item_count > 0 %}
            <sup>{{ cart.item_count }}</sup>
          {% endif %}
          {{ 'icon-cart.svg' | inline_asset_content }}
        </a>
      </div>
    </div>
  </div>

  <div class="header__bottom" aria-label="{{ 'navigation.secondary_aria' | t | escape }}">
    <nav class="header__nav" aria-label="{{ 'navigation.main_aria' | t | escape }}">
      {% liquid
        assign about_url = '/pages/about'
        assign products_url = routes.all_products_collection_url
        if section.settings.about_page != blank
          assign about_url = section.settings.about_page.url
        else
          if pages.about != blank
            assign about_url = pages.about.url
          endif
        endif
        if pages.products != blank
          assign products_url = pages.products.url
        endif
      %}
      {% if section.settings.secondary_menu != blank %}
        {% assign nav_menu = section.settings.secondary_menu %}
      {% else %}
        {% assign nav_menu = section.settings.menu %}
      {% endif %}
      {% if nav_menu and nav_menu.links.size > 0 %}
        {% liquid
          assign has_about_link = false
          for link in nav_menu.links
            if link.url == about_url
              assign has_about_link = true
            endif
            if link.url contains '/pages/about'
              assign has_about_link = true
            endif
          endfor
        %}
        {% for link in nav_menu.links %}
          {% liquid
            assign link_label = link.title | escape
            assign link_href = link.url
            assign link_hash = blank

            if link_href contains '#'
              assign link_parts = link_href | split: '#'
              assign link_href = link_parts[0]
              assign link_hash = link_parts[1]
            endif

            if link.url == routes.root_url or link.url == '/'
              assign link_label = 'navigation.home' | t | escape
              assign link_href = routes.root_url
            endif

            if link.url == products_url
              assign link_label = 'navigation.products' | t | escape
              assign link_href = products_url
            endif

            if link.url == about_url or link.url contains '/pages/about'
              assign link_label = 'navigation.about' | t | escape
              assign link_href = about_url
            endif

            if link.url contains '/pages/contact'
              assign link_label = 'navigation.contact' | t | escape
              assign link_href = link.url
            endif

            unless link_href contains 'locale='
              if link_href contains '?'
                assign link_href = link_href | append: '&' | append: locale_param
              else
                assign link_href = link_href | append: '?' | append: locale_param
              endif
            endunless

            if link_hash != blank
              assign link_href = link_href | append: '#' | append: link_hash
            endif
          %}

          <a href="{{ link_href }}">{{ link_label }}</a>
        {% endfor %}
        <a href="{{ products_url }}">{{ 'navigation.products' | t }}</a>
        {% if has_about_link == false %}
          <a href="{{ about_url }}">{{ 'navigation.about' | t }}</a>
        {% endif %}
      {% else %}
        {% liquid
          assign contact_url = section.settings.secondary_contact_url | default: '/pages/contact'
          assign contact_href = contact_url
          assign contact_hash = blank

          if contact_href contains '#'
            assign contact_parts = contact_href | split: '#'
            assign contact_href = contact_parts[0]
            assign contact_hash = contact_parts[1]
          endif

          unless contact_href contains 'locale='
            if contact_href contains '?'
              assign contact_href = contact_href | append: '&' | append: locale_param
            else
              assign contact_href = contact_href | append: '?' | append: locale_param
            endif
          endunless

          if contact_hash != blank
            assign contact_href = contact_href | append: '#' | append: contact_hash
          endif
        %}
        <a href="{{ routes.root_url }}?{{ locale_param }}">
          {{- 'navigation.home' | t -}}
        </a>
        <a href="{{ products_url }}?{{ locale_param }}">{{ 'navigation.products' | t }}</a>
        <a href="{{ about_url }}?{{ locale_param }}">{{ 'navigation.about' | t }}</a>
        <a href="{{ contact_href }}">
          {{- 'navigation.contact' | t -}}
        </a>
      {% endif %}
    </nav>
  </div>
</header>

{% stylesheet %}
  .site-header {
    background: var(--color-header-bg);
    color: var(--color-accent);
    border-block-end: 2px solid var(--color-primary);
  }
  .site-header a {
    color: var(--color-accent);
    text-decoration: none;
  }
  .header__top {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 1rem;
    align-items: center;
    /* min-height: 8rem; */
    padding-top: 0rem;
    padding-bottom: 0rem;
    padding-inline: var(--page-margin);
    padding-block: 0.5rem;
  }
  .header__brand {
    justify-self: start;
  }
  .header__title {
    font-weight: 700;
    letter-spacing: 0.02em;
  }
  .header__logo {
    height: 5.2rem;
    width: auto;
  }
  .header__utilities {
    justify-self: end;
    display: flex;
    gap: 1.25rem;
    align-items: center;
  }
  .header__icons {
    display: flex;
    gap: 0.75rem;
    align-items: center;
  }
  .header__account {
    font-size: 0.9rem;
  }
  .header__cart {
    position: relative;
  }
  .header__cart sup {
    position: absolute;
    left: 100%;
    transform: translateX(0.15rem);
    background: var(--color-primary);
    color: var(--color-accent);
    border-radius: 999px;
    padding-inline: 0.3rem;
  }
  .header__icons svg {
    width: 1.6rem;
    height: 1.6rem;
    fill: currentColor;
  }
  .lang-button {
    background: transparent;
    border: 1px solid var(--color-accent);
    color: var(--color-accent);
    padding: 0.35rem 0.6rem;
    border-radius: 999px;
    cursor: pointer;
  }
  .header__search .search-form {
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: 0.5rem;
  }
  .search-input {
    width: 100%;
    padding: 0.55rem 0.75rem;
    border-radius: 999px;
    border: 1px solid color-mix(in oklab, var(--color-accent) 30%, transparent);
    background: var(--color-accent);
    color: var(--color-secondary);
  }
  .search-submit {
    background: var(--color-primary);
    color: var(--color-accent);
    border: none;
    border-radius: 999px;
    padding: 0.55rem 0.9rem;
    cursor: pointer;
  }
  .header__bottom {
    background: color-mix(in oklab, var(--color-secondary) 85%, black);
  }
  .header__nav {
    display: flex;
    gap: 1rem;
    justify-content: center;
    align-items: center;
    min-height: 2.75rem;
    padding-inline: var(--page-margin);
  }
  .header__nav a:hover {
    color: var(--color-link);
  }
  html[dir='rtl'] .header__top {
    grid-template-columns: auto 1fr auto;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:general.header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "t:labels.menu"
    },
    {
      "type": "link_list",
      "id": "secondary_menu",
      "label": "t:labels.menu"
    },
    {
      "type": "page",
      "id": "about_page",
      "label": "t:labels.about_page"
    },
    {
      "type": "header",
      "content": "Secondary menu (fallback)"
    },
    {
      "type": "text",
      "id": "secondary_home_label",
      "label": "Home label",
      "default": "Home"
    },
    {
      "type": "text",
      "id": "secondary_home_url",
      "label": "Home URL",
      "default": "/"
    },
    {
      "type": "text",
      "id": "secondary_contact_label",
      "label": "Contact us label",
      "default": "Contact us"
    },
    {
      "type": "text",
      "id": "secondary_contact_url",
      "label": "Contact us URL",
      "default": "/pages/contact"
    }
  ]
}
{% endschema %}
