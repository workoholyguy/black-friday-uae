<header class="site-header full-width">
  <div class="header__top">
    <div class="header__brand">
      <a class="header__home" href="{{ routes.root_url }}" aria-label="{{ shop.name }}">
        {% if section.settings.logo != blank %}
          {{ section.settings.logo | image_url: width: 180 | image_tag: alt: shop.name, class: 'header__logo' }}
        {% else %}
          <span class="header__title">{{ shop.name }}</span>
        {% endif %}
      </a>
    </div>

    <div class="header__search">
      <form class="search-form" action="{{ routes.search_url }}" method="get" role="search">
        <input class="search-input" type="search" name="q" value="{{ search.terms | escape }}" placeholder="{{ 'search.placeholder' | t }}" aria-label="{{ 'search.title' | t }}">
        <button class="search-submit" type="submit">{{ 'search.submit' | t }}</button>
      </form>
    </div>

    <div class="header__utilities">
      <div class="header__lang">
        {%- form 'localization', class: 'lang-form' -%}
          <input type="hidden" name="locale_code" value="{% if localization.language.iso_code contains 'ar' %}en{% else %}ar{% endif %}">
          <button type="submit" class="lang-button">
            {% if localization.language.iso_code contains 'ar' %}English{% else %}العربية{% endif %}
          </button>
        {%- endform -%}
      </div>
      <div class="header__icons">
        {% if shop.customer_accounts_enabled %}
          <a class="header__account" href="{{ routes.account_url }}">{{ 'customers.login.title' | t }}</a>
        {% endif %}
        <a class="header__cart" href="{{ routes.cart_url }}" aria-label="{{ 'cart.title' | t }}">
          {% if cart.item_count > 0 %}
            <sup>{{ cart.item_count }}</sup>
          {% endif %}
          {{ 'icon-cart.svg' | inline_asset_content }}
        </a>
      </div>
    </div>
  </div>

  <div class="header__bottom" aria-label="Secondary">
    <nav class="header__nav" aria-label="Main">
      {% liquid
        assign about_url = '/pages/about'
        if section.settings.about_page != blank
          assign about_url = section.settings.about_page.url
        else
          if pages['about'] != blank
            assign about_url = pages['about'].url
          endif
        endif
      %}
      {% if section.settings.secondary_menu != blank %}
        {% assign nav_menu = section.settings.secondary_menu %}
      {% else %}
        {% assign nav_menu = section.settings.menu %}
      {% endif %}
      {% if nav_menu and nav_menu.links.size > 0 %}
        {% liquid
          assign has_about_link = false
          for link in nav_menu.links
            if link.url == about_url
              assign has_about_link = true
            endif
            if link.url contains '/pages/about'
              assign has_about_link = true
            endif
          endfor
        %}
        {% for link in nav_menu.links %}
          {{ link.title | link_to: link.url }}
          {% if forloop.first and section.settings.show_categories and section.settings.categories != blank %}
            <details class="nav__dropdown">
              <summary class="nav__trigger">{{ 'navigation.categories' | t }}</summary>
              <ul class="nav__panel">
                {% for handle in section.settings.categories %}
                  {% assign col = collections[handle] %}
                  {% if col %}
                    <li><a href="{{ col.url }}">{{ col.title }}</a></li>
                  {% endif %}
                {% endfor %}
              </ul>
            </details>
          {% endif %}
        {% endfor %}
        {% if has_about_link == false %}
          <a href="{{ about_url }}">{{ 'navigation.about' | t }}</a>
        {% endif %}
      {% else %}
        <a href="{{ section.settings.secondary_home_url | default: '/' }}">{{ section.settings.secondary_home_label | default: 'Home' }}</a>
        {% if section.settings.show_categories and section.settings.categories != blank %}
          <details class="nav__dropdown">
            <summary class="nav__trigger">{{ section.settings.secondary_categories_label | default: 'Categories' }}</summary>
            <ul class="nav__panel">
              {% for handle in section.settings.categories %}
                {% assign col = collections[handle] %}
                {% if col %}
                  <li><a href="{{ col.url }}">{{ col.title }}</a></li>
                {% endif %}
              {% endfor %}
            </ul>
          </details>
        {% else %}
          <a href="{{ section.settings.secondary_categories_url | default: '/collections' }}">{{ section.settings.secondary_categories_label | default: 'Categories' }}</a>
        {% endif %}
        <a href="{{ section.settings.secondary_brands_url | default: '/pages/brands' }}">{{ section.settings.secondary_brands_label | default: 'Our Top Brands' }}</a>
        <a href="{{ about_url }}">{{ 'navigation.about' | t }}</a>
        <a href="{{ section.settings.secondary_contact_url | default: '/pages/contact' }}">{{ section.settings.secondary_contact_label | default: 'Contact us' }}</a>
      {% endif %}
    </nav>
  </div>
</header>

{% stylesheet %}
  .site-header {
    background: var(--color-header-bg);
    color: var(--color-accent);
    border-block-end: 2px solid var(--color-primary);
  }
  .site-header a {
    color: var(--color-accent);
    text-decoration: none;
  }
  .header__top {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 1rem;
    align-items: center;
    min-height: 5rem;
    padding-inline: var(--page-margin);
    padding-block: .5rem;
  }
  .header__brand {
    justify-self: start;
  }
  .header__title {
    font-weight: 700;
    letter-spacing: 0.02em;
  }
  .header__logo {
    height: 2.2rem;
    width: auto;
  }
  .header__utilities {
    justify-self: end;
    display: flex;
    gap: 1.25rem;
    align-items: center;
  }
  .header__icons {
    display: flex;
    gap: 0.75rem;
    align-items: center;
  }
  .header__account {
    font-size: .9rem;
  }
  .header__cart {
    position: relative;
  }
  .header__cart sup {
    position: absolute;
    left: 100%;
    transform: translateX(0.15rem);
    background: var(--color-primary);
    color: var(--color-accent);
    border-radius: 999px;
    padding-inline: 0.3rem;
  }
  .header__icons svg {
    width: 1.6rem;
    height: 1.6rem;
    fill: currentColor;
  }
  .lang-button {
    background: transparent;
    border: 1px solid var(--color-accent);
    color: var(--color-accent);
    padding: 0.35rem 0.6rem;
    border-radius: 999px;
    cursor: pointer;
  }
  .header__search .search-form {
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: .5rem;
  }
  .search-input {
    width: 100%;
    padding: .55rem .75rem;
    border-radius: 999px;
    border: 1px solid color-mix(in oklab, var(--color-accent) 30%, transparent);
    background: var(--color-accent);
    color: var(--color-secondary);
  }
  .search-submit {
    background: var(--color-primary);
    color: var(--color-accent);
    border: none;
    border-radius: 999px;
    padding: .55rem .9rem;
    cursor: pointer;
  }
  .header__bottom {
    background: color-mix(in oklab, var(--color-secondary) 85%, black);
  }
  .header__nav {
    display: flex;
    gap: 1rem;
    justify-content: center;
    align-items: center;
    min-height: 2.75rem;
    padding-inline: var(--page-margin);
  }
  .header__nav a:hover {
    color: var(--color-link);
  }
  .nav__dropdown {
    position: relative;
  }
  .nav__trigger {
    list-style: none;
    cursor: pointer;
  }
  .nav__dropdown[open] > .nav__trigger,
  .nav__dropdown:hover > .nav__trigger {
    color: var(--color-link);
  }
  .nav__panel {
    position: absolute;
    top: 100%;
    inset-inline-start: 0;
    display: grid;
    gap: .25rem;
    background: var(--color-secondary);
    color: var(--color-accent);
    border: 1px solid color-mix(in oklab, var(--color-accent) 15%, transparent);
    border-radius: .5rem;
    padding: .5rem .75rem;
    min-width: 14rem;
    z-index: 20;
  }
  .nav__panel a {
    color: var(--color-accent);
    text-decoration: none;
  }
  .nav__panel a:hover {
    color: var(--color-link);
  }
  html[dir="rtl"] .header__top {
    grid-template-columns: auto 1fr auto;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:general.header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "t:labels.menu"
    },
    {
      "type": "link_list",
      "id": "secondary_menu",
      "label": "t:labels.menu"
    },
    {
      "type": "page",
      "id": "about_page",
      "label": "t:labels.about_page"
    },
    {
      "type": "header",
      "content": "Secondary menu (fallback)"
    },
    {
      "type": "text",
      "id": "secondary_home_label",
      "label": "Home label",
      "default": "Home"
    },
    {
      "type": "text",
      "id": "secondary_home_url",
      "label": "Home URL",
      "default": "/"
    },
    {
      "type": "text",
      "id": "secondary_categories_label",
      "label": "Categories label",
      "default": "Categories"
    },
    {
      "type": "text",
      "id": "secondary_categories_url",
      "label": "Categories URL",
      "default": "/collections"
    },
    {
      "type": "text",
      "id": "secondary_brands_label",
      "label": "Our Top Brands label",
      "default": "Our Top Brands"
    },
    {
      "type": "text",
      "id": "secondary_brands_url",
      "label": "Our Top Brands URL",
      "default": "/pages/brands"
    },
    {
      "type": "text",
      "id": "secondary_contact_label",
      "label": "Contact us label",
      "default": "Contact us"
    },
    {
      "type": "text",
      "id": "secondary_contact_url",
      "label": "Contact us URL",
      "default": "/pages/contact"
    },
    {
      "type": "checkbox",
      "id": "show_categories",
      "label": "Show categories dropdown",
      "default": true
    },
    {
      "type": "collection_list",
      "id": "categories",
      "label": "Categories"
    }
  ]
}
{% endschema %}
