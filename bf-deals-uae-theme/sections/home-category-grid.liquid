<section class="home-category-grid">
  {% if section.settings.heading != blank %}
    <header class="home-category-grid__header">
      <h2 class="home-category-grid__title">{{ section.settings.heading | escape }}</h2>
    </header>
  {% endif %}

  <div
    class="home-category-grid__grid"
    style="
      --columns-desktop: {{ section.settings.columns_desktop }};
      --columns-mobile: {{ section.settings.columns_mobile }};
    "
  >
    {% for block in section.blocks %}
      {% liquid
        assign collection = block.settings.collection
        assign title = block.settings.title

        if title == blank
          if collection != blank
            assign title = collection.title
          else
            assign title = 'home.categories.placeholder_title' | t
          endif
        endif
      %}

      {% if collection != blank %}
        <a class="home-category-card" href="{{ collection.url }}" {{ block.shopify_attributes }}>
      {% else %}
        <div class="home-category-card home-category-card--placeholder" {{ block.shopify_attributes }}>
      {% endif %}
      <div class="home-category-card__media">
        {% if block.settings.image %}
          {% render 'image',
            class: 'home-category-card__image',
            image: block.settings.image,
            width: 900,
            height: 900,
            crop: 'center'
          %}
        {% elsif collection != blank and collection.featured_image %}
          {% render 'image',
            class: 'home-category-card__image',
            image: collection.featured_image,
            width: 900,
            height: 900,
            crop: 'center'
          %}
        {% else %}
          {{ 'collection-1' | placeholder_svg_tag: 'home-category-card__placeholder' }}
        {% endif %}
      </div>

      <div class="home-category-card__content">
        <p class="home-category-card__name">{{ title | escape }}</p>
        {% if collection != blank %}
          <span class="home-category-card__cta">{{ 'home.categories.shop_now' | t }}</span>
        {% else %}
          <span class="home-category-card__cta">{{ 'home.categories.choose_collection' | t }}</span>
        {% endif %}
      </div>
      {% if collection != blank %}
        </a>
      {% else %}
        </div>
      {% endif %}
    {% endfor %}
  </div>
</section>

{% stylesheet %}
  .home-category-grid {
    padding: clamp(1.1rem, 4vw, 2.25rem) var(--page-margin);
  }

  .home-category-grid__header {
    display: flex;
    align-items: end;
    justify-content: space-between;
    margin-block-end: 1rem;
  }

  .home-category-grid__title {
    font-size: clamp(1.25rem, 2.2vw, 1.6rem);
    font-weight: 800;
    letter-spacing: -0.02em;
  }

  .home-category-grid__grid {
    display: grid;
    gap: clamp(0.75rem, 2vw, 1.1rem);
    grid-template-columns: repeat(var(--columns-mobile, 2), minmax(0, 1fr));
  }

  .home-category-card {
    display: grid;
    gap: 0.75rem;
    text-decoration: none;
    color: inherit;
    border-radius: 18px;
    overflow: hidden;
    border: 1px solid color-mix(in srgb, var(--color-foreground) 12%, transparent);
    background: color-mix(in srgb, var(--color-background) 96%, var(--color-foreground) 4%);
  }

  .home-category-card__media {
    aspect-ratio: 1 / 1;
    background: color-mix(in srgb, var(--color-foreground) 6%, transparent);
  }

  .home-category-card__image > img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .home-category-card__placeholder {
    width: 100%;
    height: 100%;
  }

  .home-category-card__content {
    padding: 0 0.95rem 1rem 0.95rem;
    display: grid;
    gap: 0.35rem;
  }

  .home-category-card__name {
    font-weight: 800;
    letter-spacing: -0.01em;
  }

  .home-category-card__cta {
    font-weight: 800;
    color: var(--color-primary);
  }

  .home-category-card--placeholder {
    opacity: 0.85;
  }

  @media (min-width: 900px) {
    .home-category-grid__grid {
      grid-template-columns: repeat(var(--columns-desktop, 3), minmax(0, 1fr));
    }
  }

  @media (max-width: 750px) {
    .home-category-grid {
      padding: clamp(1rem, 4vw, 1.5rem) var(--page-margin);
      margin-block-start: 1rem;
    }
    .home-category-grid__grid {
      gap: 0.75rem;
    }
    .home-category-card__content {
      padding: 0 0.85rem 0.9rem 0.85rem;
    }
  }

  @media (prefers-reduced-motion: no-preference) {
    .home-category-card {
      transition: transform 160ms ease, border-color 160ms ease;
    }

    .home-category-card:hover {
      transform: translateY(-2px);
      border-color: color-mix(in srgb, var(--color-foreground) 20%, transparent);
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Home category grid",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Shop by category"
    },
    {
      "type": "select",
      "id": "columns_desktop",
      "label": "Columns on desktop",
      "options": [
        { "value": "2", "label": "2" },
        { "value": "3", "label": "3" }
      ],
      "default": "3"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "Columns on mobile",
      "options": [
        { "value": "1", "label": "1" },
        { "value": "2", "label": "2" }
      ],
      "default": "2"
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "Category",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image (square)"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title override",
          "info": "Leave blank to use the collection title."
        }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [
    {
      "name": "Home category grid",
      "blocks": [
        { "type": "category" },
        { "type": "category" },
        { "type": "category" },
        { "type": "category" },
        { "type": "category" },
        { "type": "category" }
      ]
    }
  ]
}
{% endschema %}
